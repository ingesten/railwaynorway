<!DOCTYPE html>
<html lang="en">
<head>

    <!-- 
          Version: 9
        This page will rotate between a Bane NOR fullscreen train status of your selected railway station 
        and a Yr.no meteogram SVG for weather forecast. Additionally, it fetches NRK news RSS feed asynchronously.
        Author: isten
        Date: 2024-11-05
    -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rotating Pages with Meteogram and NRK News</title>
    <style>
        /* Styling for the debug information at the top */
        #debug {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 10%; /* Top 10% of the screen */
            background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent black background */
            color: white;
            padding: 10px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            z-index: 100; /* Make sure it's on top */
        }

        /* Styling for the iframe to fill 90% of the remaining screen */
        #webframe {
            position: absolute;
            top: 10%; /* Start below the debug section */
            left: 0;
            width: 100%;
            height: 80%; /* Bottom 80% of the screen */
        }

        /* Styling for the meteogram container */
        #meteogram-container {
            display: none;
            position: absolute;
            top: 10%; /* Start below the debug section */
            left: 0;
            width: 100%;
            height: 80%; /* Bottom 80% of the screen */
            text-align: center;
        }

        /* SVG will take up 100% of the available height */
        #meteogram {
            height: 100%;
        }

        /* RSS news ticker styling */
        #rss-ticker {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 10%;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-family: Arial, sans-serif;
            font-size: 16px;
            padding: 10px;
            overflow: hidden;
            white-space: nowrap;
        }

        .news-ticker {
            display: inline-block;
            animation: scroll-left 20s linear infinite;
        }

        @keyframes scroll-left {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }
    </style>

    <script>
        const ROTATION_INTERVAL = 20000; // Time interval in milliseconds (20 seconds)
        const urls = [
            "https://rtd.banenor.no/web_client/std?station=JEH&layout=landscape&content=departure&notice=yes",   // Train status page
            "meteogram" // Placeholder to display the Yr.no meteogram SVG
        ];

        let currentIndex = 0;
        let rotationCount = 0; // To count how many times the rotation has occurred

        function updateDebugInfo() {
            const debugElement = document.getElementById('debug');
            debugElement.innerHTML = `Rotation Count: ${rotationCount} | Current Display: ${currentIndex === 1 ? 'Yr.no Meteogram' : urls[currentIndex]}`;
        }

        function rotatePages() {
            if (urls[currentIndex] === "meteogram") {
                // Show the meteogram SVG
                document.getElementById('webframe').style.display = 'none';
                document.getElementById('meteogram-container').style.display = 'block';
            } else {
                // Show the train status iframe
                document.getElementById('meteogram-container').style.display = 'none';
                document.getElementById('webframe').style.display = 'block';
                document.getElementById('webframe').src = urls[currentIndex];
            }

            // Update debug info
            rotationCount++;
            updateDebugInfo();

            // Update index to the next URL
            currentIndex = (currentIndex + 1) % urls.length;

            // Set timer to load the next content after ROTATION_INTERVAL
            setTimeout(rotatePages, ROTATION_INTERVAL);
        }

        // Function to fetch RSS feed asynchronously
        async function fetchRSSFeed() {
            try {
                const response = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://www.nrk.no/nyheter/siste.rss');
                const data = await response.json();
                const items = data.items;
                const tickerElement = document.getElementById('rss-ticker');
                let tickerHTML = '<div class="news-ticker">';

                items.forEach(item => {
                    tickerHTML += `<span>${item.title} - </span>`;
                });

                tickerHTML += '</div>';
                tickerElement.innerHTML = tickerHTML;
            } catch (error) {
                console.error('Error fetching RSS feed:', error);
            }
        }

        // Start rotation and fetch RSS when the page loads
        window.onload = function() {
            updateDebugInfo(); // Initial update of debug info
            rotatePages(); // Start the rotation
            fetchRSSFeed(); // Fetch the RSS feed asynchronously
        };
    </script>
</head>
<body>
    <!-- Debug info will appear here -->
    <div id="debug"></div>
    
    <!-- The iframe for rotating pages -->
    <iframe id="webframe" frameborder="0"></iframe>

    <!-- Meteogram SVG container -->
    <div id="meteogram-container">
        <img id="meteogram" src="https://www.yr.no/nb/innhold/1-87761/meteogram.svg" alt="Yr.no Meteogram" />
    </div>

    <!-- RSS News Ticker -->
    <div id="rss-ticker">Loading news...</div>

</body>
</html>
